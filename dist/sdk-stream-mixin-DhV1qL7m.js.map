{"version":3,"file":"sdk-stream-mixin-DhV1qL7m.js","sources":["../node_modules/@smithy/util-stream/dist-es/stream-type-check.js","../node_modules/@smithy/fetch-http-handler/dist-es/stream-collector.js","../node_modules/@smithy/util-stream/dist-es/sdk-stream-mixin.browser.js","../node_modules/@smithy/util-stream/dist-es/sdk-stream-mixin.js"],"sourcesContent":["export const isReadableStream = (stream) => typeof ReadableStream === \"function\" &&\n    (stream?.constructor?.name === ReadableStream.name || stream instanceof ReadableStream);\nexport const isBlob = (blob) => {\n    return typeof Blob === \"function\" && (blob?.constructor?.name === Blob.name || blob instanceof Blob);\n};\n","import { fromBase64 } from \"@smithy/util-base64\";\nexport const streamCollector = async (stream) => {\n    if ((typeof Blob === \"function\" && stream instanceof Blob) || stream.constructor?.name === \"Blob\") {\n        if (Blob.prototype.arrayBuffer !== undefined) {\n            return new Uint8Array(await stream.arrayBuffer());\n        }\n        return collectBlob(stream);\n    }\n    return collectStream(stream);\n};\nasync function collectBlob(blob) {\n    const base64 = await readToBase64(blob);\n    const arrayBuffer = fromBase64(base64);\n    return new Uint8Array(arrayBuffer);\n}\nasync function collectStream(stream) {\n    const chunks = [];\n    const reader = stream.getReader();\n    let isDone = false;\n    let length = 0;\n    while (!isDone) {\n        const { done, value } = await reader.read();\n        if (value) {\n            chunks.push(value);\n            length += value.length;\n        }\n        isDone = done;\n    }\n    const collected = new Uint8Array(length);\n    let offset = 0;\n    for (const chunk of chunks) {\n        collected.set(chunk, offset);\n        offset += chunk.length;\n    }\n    return collected;\n}\nfunction readToBase64(blob) {\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onloadend = () => {\n            if (reader.readyState !== 2) {\n                return reject(new Error(\"Reader aborted too early\"));\n            }\n            const result = (reader.result ?? \"\");\n            const commaIndex = result.indexOf(\",\");\n            const dataOffset = commaIndex > -1 ? commaIndex + 1 : result.length;\n            resolve(result.substring(dataOffset));\n        };\n        reader.onabort = () => reject(new Error(\"Read aborted\"));\n        reader.onerror = () => reject(reader.error);\n        reader.readAsDataURL(blob);\n    });\n}\n","import { streamCollector } from \"@smithy/fetch-http-handler\";\nimport { toBase64 } from \"@smithy/util-base64\";\nimport { toHex } from \"@smithy/util-hex-encoding\";\nimport { toUtf8 } from \"@smithy/util-utf8\";\nimport { isReadableStream } from \"./stream-type-check\";\nconst ERR_MSG_STREAM_HAS_BEEN_TRANSFORMED = \"The stream has already been transformed.\";\nexport const sdkStreamMixin = (stream) => {\n    if (!isBlobInstance(stream) && !isReadableStream(stream)) {\n        const name = stream?.__proto__?.constructor?.name || stream;\n        throw new Error(`Unexpected stream implementation, expect Blob or ReadableStream, got ${name}`);\n    }\n    let transformed = false;\n    const transformToByteArray = async () => {\n        if (transformed) {\n            throw new Error(ERR_MSG_STREAM_HAS_BEEN_TRANSFORMED);\n        }\n        transformed = true;\n        return await streamCollector(stream);\n    };\n    const blobToWebStream = (blob) => {\n        if (typeof blob.stream !== \"function\") {\n            throw new Error(\"Cannot transform payload Blob to web stream. Please make sure the Blob.stream() is polyfilled.\\n\" +\n                \"If you are using React Native, this API is not yet supported, see: https://react-native.canny.io/feature-requests/p/fetch-streaming-body\");\n        }\n        return blob.stream();\n    };\n    return Object.assign(stream, {\n        transformToByteArray: transformToByteArray,\n        transformToString: async (encoding) => {\n            const buf = await transformToByteArray();\n            if (encoding === \"base64\") {\n                return toBase64(buf);\n            }\n            else if (encoding === \"hex\") {\n                return toHex(buf);\n            }\n            else if (encoding === undefined || encoding === \"utf8\" || encoding === \"utf-8\") {\n                return toUtf8(buf);\n            }\n            else if (typeof TextDecoder === \"function\") {\n                return new TextDecoder(encoding).decode(buf);\n            }\n            else {\n                throw new Error(\"TextDecoder is not available, please make sure polyfill is provided.\");\n            }\n        },\n        transformToWebStream: () => {\n            if (transformed) {\n                throw new Error(ERR_MSG_STREAM_HAS_BEEN_TRANSFORMED);\n            }\n            transformed = true;\n            if (isBlobInstance(stream)) {\n                return blobToWebStream(stream);\n            }\n            else if (isReadableStream(stream)) {\n                return stream;\n            }\n            else {\n                throw new Error(`Cannot transform payload to web stream, got ${stream}`);\n            }\n        },\n    });\n};\nconst isBlobInstance = (stream) => typeof Blob === \"function\" && stream instanceof Blob;\n","import { streamCollector } from \"@smithy/node-http-handler\";\nimport { fromArrayBuffer } from \"@smithy/util-buffer-from\";\nimport { Readable } from \"stream\";\nimport { sdkStreamMixin as sdkStreamMixinReadableStream } from \"./sdk-stream-mixin.browser\";\nconst ERR_MSG_STREAM_HAS_BEEN_TRANSFORMED = \"The stream has already been transformed.\";\nexport const sdkStreamMixin = (stream) => {\n    if (!(stream instanceof Readable)) {\n        try {\n            return sdkStreamMixinReadableStream(stream);\n        }\n        catch (e) {\n            const name = stream?.__proto__?.constructor?.name || stream;\n            throw new Error(`Unexpected stream implementation, expect Stream.Readable instance, got ${name}`);\n        }\n    }\n    let transformed = false;\n    const transformToByteArray = async () => {\n        if (transformed) {\n            throw new Error(ERR_MSG_STREAM_HAS_BEEN_TRANSFORMED);\n        }\n        transformed = true;\n        return await streamCollector(stream);\n    };\n    return Object.assign(stream, {\n        transformToByteArray,\n        transformToString: async (encoding) => {\n            const buf = await transformToByteArray();\n            if (encoding === undefined || Buffer.isEncoding(encoding)) {\n                return fromArrayBuffer(buf.buffer, buf.byteOffset, buf.byteLength).toString(encoding);\n            }\n            else {\n                const decoder = new TextDecoder(encoding);\n                return decoder.decode(buf);\n            }\n        },\n        transformToWebStream: () => {\n            if (transformed) {\n                throw new Error(ERR_MSG_STREAM_HAS_BEEN_TRANSFORMED);\n            }\n            if (stream.readableFlowing !== null) {\n                throw new Error(\"The stream has been consumed by other callbacks.\");\n            }\n            if (typeof Readable.toWeb !== \"function\") {\n                throw new Error(\"Readable.toWeb() is not supported. Please ensure a polyfill is available.\");\n            }\n            transformed = true;\n            return Readable.toWeb(stream);\n        },\n    });\n};\n"],"names":["ERR_MSG_STREAM_HAS_BEEN_TRANSFORMED","sdkStreamMixin","sdkStreamMixinReadableStream","streamCollector"],"mappings":"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","x_google_ignoreList":[0,1,2,3]}